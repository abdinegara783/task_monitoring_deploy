{% extends 'base.html' %}

{% block title %}Mekanik Dashboard - Sistem Pelaporan Kerja{% endblock %}

{% block content %}
<div class="container mx-auto p-6">
    <!-- Header with Logout -->
    <div class="flex items-center justify-between mb-6 p-4 bg-white rounded-lg shadow-sm border">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Sistem Pelaporan Kerja</h1>
            <p class="text-gray-600">Dashboard Mekanik - Pelaporan Harian & Bulanan</p>
        </div>
        
        <div class="flex items-center gap-4">
                        <!-- Notifications -->
            <div class="relative">
                <button id="notification-btn" class="relative p-2 hover:bg-gray-100 rounded-md">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    {% if unread_notifications_count > 0 %}
                    <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs text-white flex items-center justify-center">{{ unread_notifications_count }}</span>
                    {% endif %}
                </button>
                
                <!-- Notification Dropdown -->
                <div id="notification-dropdown" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border z-50">
                    <div class="p-3 border-b flex justify-between items-center">
                        <h3 class="font-semibold">Notifikasi</h3>
                        <a href="{% url 'notifications' %}" class="text-xs text-blue-600 hover:underline">Lihat Semua</a>
                    </div>
                    
                    <div class="max-h-96 overflow-y-auto" id="notification-list">
                        {% if notifications %}
                            <ul class="divide-y divide-gray-100">
                                {% for notification in notifications|slice:":5" %}
                                <li class="p-3 {% if notification.status == 'unread' %}bg-blue-50{% endif %}">
                                    <div class="flex items-start">
                                        {% if notification.notification_type == 'activity_reminder' %}
                                            <span class="w-8 h-8 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center mr-2">
                                                <i data-lucide="clipboard-list" class="w-4 h-4"></i>
                                            </span>
                                        {% elif notification.notification_type == 'analysis_reminder' %}
                                            <span class="w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center mr-2">
                                                <i data-lucide="bar-chart" class="w-4 h-4"></i>
                                            </span>
                                        {% endif %}
                                        <div>
                                            <h4 class="font-medium text-sm">{{ notification.title }}</h4>
                                            <p class="text-xs text-gray-600 mt-1">{{ notification.message|truncatechars:60 }}</p>
                                            <span class="text-xs text-gray-500 mt-1 block">{{ notification.created_at|date:"d M Y, H:i" }}</span>
                                        </div>
                                    </div>
                                </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <div class="p-4 text-center text-gray-500">
                                <i data-lucide="bell-off" class="w-6 h-6 mx-auto mb-2 text-gray-400"></i>
                                <p class="text-sm">Tidak ada notifikasi</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="px-3 py-1 border rounded-md flex items-center">
                <i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                Shift {{ user.shift }} - <span id="current-time"></span>
            </div>
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                    <span class="text-white font-medium">{{ user.first_name.0 }}{{ user.last_name.0 }}</span>
                </div>
                <div class="text-left">
                    <p class="font-semibold text-sm">{{ user.get_full_name }}</p>
                    <p class="text-xs text-gray-600">{{ user.department }}</p>
                </div>
                <a href="{% url 'logout' %}" class="ml-2 px-3 py-1 text-red-600 hover:bg-red-50 rounded-md text-sm flex items-center">
                    <i data-lucide="log-out" class="w-4 h-4 mr-1"></i>
                    Keluar
                </a>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto space-y-8">
        <!-- Welcome Header -->
        <div class="text-center space-y-2">
            <h2 class="text-2xl font-bold text-gray-900">
                Halo, {{ user.get_full_name }}! 👋
            </h2>
            <p class="text-gray-600">
                Ayo lengkapi laporan harian dan bulanan Anda
            </p>
        </div>

        {% if messages %}
            {% for message in messages %}
                <div class="alert-message p-4 rounded-lg border {% if message.tags == 'success' %}bg-green-50 border-green-200 text-green-800{% else %}bg-red-50 border-red-200 text-red-800{% endif %}">
                    <div class="flex items-center">
                        <i data-lucide="{% if message.tags == 'success' %}check-circle{% else %}alert-circle{% endif %}" class="w-4 h-4 mr-2"></i>
                        {{ message }}
                    </div>
                </div>
            {% endfor %}
        {% endif %}

        <!-- Main Action Cards -->
        <div class="space-y-6">
            <div class="flex items-center justify-between mb-6 p-4 bg-white rounded-lg shadow-sm border">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Sistem Pelaporan Kerja</h1>
                    <p class="text-gray-600">Dashboard Mekanik - Pelaporan Harian & Bulanan</p>
                </div>
                
                <div class="flex items-center gap-4">
                    <a href="{% url 'foreman_report_status' %}" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 flex items-center gap-2 shadow-md transition-all duration-200 hover:shadow-lg">
                        <i data-lucide="list" class="w-5 h-5"></i>
                        Status Laporan
                    </a>
                </div>
            </div>
            <!-- Activity Report - Today's Priority -->
            <div class="bg-white border-2 border-blue-200 shadow-lg rounded-lg">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center">
                                <i data-lucide="file-text" class="w-8 h-8 text-white"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Mechanic Activity Report</h3>
                                <p class="text-gray-600">Activity Report untuk hari ini</p>
                            </div>
                        </div>
                        {% if activity_report_today %}
                            <div class="text-center">
                                <i data-lucide="check-circle-2" class="w-12 h-12 text-green-500 mx-auto mb-2"></i>
                                <span class="px-3 py-1 bg-green-500 text-white text-sm font-medium rounded-full">Selesai</span>
                            </div>
                        {% else %}
                            <div class="text-center">
                                <i data-lucide="clock" class="w-12 h-12 text-orange-500 mx-auto mb-2"></i>
                                <span class="px-3 py-1 bg-red-500 text-white text-sm font-medium rounded-full">Belum Diisi</span>
                            </div>
                        {% endif %}
                    </div>

                    <div class="space-y-4">
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-orange-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h3 class="text-sm font-medium text-orange-800">Activity Report Belum Diisi</h3>
                                    <div class="mt-2 text-sm text-orange-700">
                                        {% if user.shift == 1 %}
                                            <span class="font-medium text-orange-800">Deadline: 18:00 (Shift 1)</span>
                                        {% else %}
                                            <span class="font-medium text-orange-800">Deadline: 05:00 (Shift 2)</span>
                                        {% endif %}
                                    </div>
                                    <p class="mt-1 text-sm text-orange-600">
                                        {% if user.shift == 1 %}
                                            Jangan lupa isi laporan aktivitas hari ini sebelum jam 18:00
                                        {% else %}
                                            Jangan lupa isi laporan aktivitas hari ini sebelum jam 05:00
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <a href="{% url 'create_activity_report' %}" 
                           class="block w-full h-12 bg-primary text-primary-foreground hover:bg-primary/90 rounded-md font-medium transition-colors flex items-center justify-center text-lg">
                            <i data-lucide="plus" class="w-5 h-5 mr-2"></i>
                            Isi Laporan Harian
                        </a>
                    </div>
                </div>
            </div>

            <!-- Analysis Report - Monthly Progress -->
            <div class="bg-white border-2 border-purple-200 shadow-lg rounded-lg">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center">
                                <i data-lucide="trending-up" class="w-8 h-8 text-white"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Technical Analysis Report</h3>
                                <p class="text-gray-600">Analysis Report bulanan</p>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-600">
                                {{ analysis_reports_count }}/3
                            </div>
                            <p class="text-sm text-gray-600">Bulan ini</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        {% if analysis_reports_count < analysis_reports_required %}
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <i data-lucide="target" class="w-5 h-5 text-purple-600"></i>
                                    <span class="font-medium text-purple-800">
                                        Masih perlu {{ analysis_reports_required|add:analysis_reports_count|add:"-"|add:analysis_reports_count }} laporan lagi
                                    </span>
                                </div>
                                <p class="text-sm text-purple-700">
                                    Target minimum {{ analysis_reports_required }} laporan analisis per bulan
                                </p>
                            </div>
                        {% endif %}

                        <a href="{% if analysis_reports_count < analysis_reports_required %}{% url 'create_analysis_report' %}{% else %}#{% endif %}" 
                           class="block w-full h-12 {% if analysis_reports_count >= analysis_reports_required %}bg-gray-300 text-gray-500 cursor-not-allowed{% else %}border border-purple-300 text-purple-700 hover:bg-purple-50{% endif %} rounded-md font-medium transition-colors flex items-center justify-center text-lg">
                            {% if analysis_reports_count >= analysis_reports_required %}
                                <i data-lucide="check-circle-2" class="w-5 h-5 mr-2"></i>
                                Target Bulan Ini Tercapai
                            {% else %}
                                <i data-lucide="plus" class="w-5 h-5 mr-2"></i>
                                Buat Laporan Analisis
                            {% endif %}
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Status -->
        <div class="bg-white shadow-md rounded-lg">
            <div class="p-6 border-b">
                <h3 class="text-lg font-bold flex items-center gap-2">
                    <i data-lucide="bell" class="w-5 h-5 text-blue-500"></i>
                    Status Laporan Terbaru
                </h3>
            </div>
            <div class="p-6">
                <div class="space-y-3">
                    {% for report in recent_reports|slice:":5" %}
                        <div class="report-item flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors" 
                             onclick="showReportDetail('{{ report.type }}', {{ report.report_data|safe }})">
                            <div class="flex items-center gap-3">
                                {% if report.type == 'activity' %}
                                <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                                {% else %}
                                <div class="w-3 h-3 rounded-full bg-purple-500"></div>
                                {% endif %}
                                <div>
                                    <p class="font-medium text-sm">{{ report.title }}</p>
                                    <p class="text-xs text-gray-600">{{ report.date|date:"d M Y" }}</p>
                                    <p class="text-xs text-gray-500">{{ report.time }}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                                    Terkirim
                                </span>
                                <p class="text-xs text-gray-500 mt-1 max-w-[200px] truncate">
                                    {{ report.description }}
                                </p>
                            </div>
                        </div>
                    {% empty %}
                        <div class="text-center py-8">
                            <i data-lucide="file-text" class="w-12 h-12 text-gray-300 mx-auto mb-2"></i>
                            <p class="text-gray-500">Belum ada laporan yang dikirim</p>
                            <p class="text-xs text-gray-400 mt-1">Mulai dengan membuat laporan pertama Anda</p>
                        </div>
                    {% endfor %}
                </div>
                
                {% if recent_reports|length > 5 %}
                    <div class="mt-4 text-center">
                        <a href="#" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            Lihat Semua Laporan
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

<!-- Universal Report Detail Modal -->
<div id="reportModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 8px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
        <!-- Header -->
        <div style="padding: 20px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
            <h3 id="modalTitle" style="font-size: 18px; font-weight: bold; margin: 0;">Detail Report</h3>
            <button id="closeModal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
        </div>
        
        <!-- Content -->
        <div id="modalContent" style="padding: 20px;">
            <!-- Content will be populated by JavaScript -->
        </div>
        
        <!-- Footer -->
        <div style="padding: 20px; border-top: 1px solid #e5e7eb; text-align: right; background: #f9fafb;">
            <button id="closeModalBtn" style="background: #6b7280; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Tutup</button>
        </div>
    </div>
</div>

<script>
// Universal report detail popup
function showReportDetail(type, data) {
    console.log('Showing report detail:', type, data);
    
    const modal = document.getElementById('reportModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalContent = document.getElementById('modalContent');
    
    if (type === 'activity') {
        modalTitle.textContent = 'Detail Activity Report';
        modalContent.innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div style="background: #f9fafb; padding: 16px; border-radius: 8px;">
                    <h4 style="font-weight: 600; margin-bottom: 12px; color: #374151;">📅 Informasi Dasar</h4>
                    <div style="font-size: 14px; line-height: 1.5;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">Tanggal:</span>
                            <span style="font-weight: 500;">${data.date}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">Waktu:</span>
                            <span style="font-weight: 500;">${data.start_time} - ${data.end_time}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">Unit Code:</span>
                            <span style="font-weight: 500;">${data.unit_code}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #6b7280;">HM/KM:</span>
                            <span style="font-weight: 500;">${data.hmkm}</span>
                        </div>
                    </div>
                </div>
                
                <div style="background: #f9fafb; padding: 16px; border-radius: 8px;">
                    <h4 style="font-weight: 600; margin-bottom: 12px; color: #374151;">🔧 Detail Pekerjaan</h4>
                    <div style="font-size: 14px; line-height: 1.5;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">Leader:</span>
                            <span style="font-weight: 500;">${getLeaderName(data.leader)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">Component:</span>
                            <span style="font-weight: 500;">${getComponentName(data.component)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #6b7280;">Activity Code:</span>
                            <span style="font-weight: 500;">${data.activities_code}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="background: #f9fafb; padding: 16px; border-radius: 8px;">
                <h4 style="font-weight: 600; margin-bottom: 12px; color: #374151;">📝 Deskripsi Aktivitas</h4>
                <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #e5e7eb;">
                    <p style="margin: 0; font-size: 14px; line-height: 1.6; color: #374151;">${data.activities}</p>
                </div>
            </div>
        `;
    } else if (type === 'analysis') {
        modalTitle.textContent = 'Detail Analysis Report';
        modalContent.innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div style="background: #f9fafb; padding: 16px; border-radius: 8px;">
                    <h4 style="font-weight: 600; margin-bottom: 12px; color: #374151;">📋 Informasi Laporan</h4>
                    <div style="font-size: 14px; line-height: 1.5;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">No. Laporan:</span>
                            <span style="font-weight: 500;">${data.no_report}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">Tanggal:</span>
                            <span style="font-weight: 500;">${data.report_date}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">Section:</span>
                            <span style="font-weight: 500;">${data.section_track}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #6b7280;">Unit Code:</span>
                            <span style="font-weight: 500;">${data.unit_code}</span>
                        </div>
                    </div>
                </div>
                
                <div style="background: #f9fafb; padding: 16px; border-radius: 8px;">
                    <h4 style="font-weight: 600; margin-bottom: 12px; color: #374151;">🔧 Work Order</h4>
                    <div style="font-size: 14px; line-height: 1.5;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">WO Number:</span>
                            <span style="font-weight: 500;">${data.wo_number}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">WO Date:</span>
                            <span style="font-weight: 500;">${data.wo_date}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">Problem:</span>
                            <span style="font-weight: 500;">${data.problem}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #6b7280;">HM:</span>
                            <span style="font-weight: 500;">${data.hm}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="background: #f9fafb; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="font-weight: 600; margin-bottom: 12px; color: #374151;">⚠️ Deskripsi Masalah</h4>
                <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #e5e7eb;">
                    <p style="margin: 0; font-size: 14px; line-height: 1.6; color: #374151;">${data.title_problem}</p>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div style="background: #f9fafb; padding: 16px; border-radius: 8px;">
                    <h4 style="font-weight: 600; margin-bottom: 12px; color: #374151;">🔩 Part Information</h4>
                    <div style="font-size: 14px; line-height: 1.5;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #6b7280;">Part No:</span>
                            <span style="font-weight: 500;">${data.part_no}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #6b7280;">Part Name:</span>
                            <span style="font-weight: 500;">${data.part_name}</span>
                        </div>
                    </div>
                </div>
                
                <div style="background: #f9fafb; padding: 16px; border-radius: 8px;">
                    <h4 style="font-weight: 600; margin-bottom: 12px; color: #374151;">📅 Trouble Info</h4>
                    <div style="font-size: 14px; line-height: 1.5;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #6b7280;">Trouble Date:</span>
                            <span style="font-weight: 500;">${data.trouble_date}</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    // Show modal
    modal.style.display = 'block';
    document.body.style.overflow = 'hidden';
}

// Close modal functions
function closeModal() {
    const modal = document.getElementById('reportModal');
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
}

document.addEventListener('DOMContentLoaded', function() {
    const closeBtn = document.getElementById('closeModal');
    const closeBtnFooter = document.getElementById('closeModalBtn');
    const modal = document.getElementById('reportModal');
    
    if (closeBtn) {
        closeBtn.addEventListener('click', closeModal);
    }
    
    if (closeBtnFooter) {
        closeBtnFooter.addEventListener('click', closeModal);
    }
    
    // Close when clicking outside
    if (modal) {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });
    }
    
    // Close with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal && modal.style.display === 'block') {
            closeModal();
        }
    });
});

// Helper functions
function getLeaderName(leaderCode) {
    const leaders = {
        'Leader_1': 'YUDI SULISTIYONO',
        'Leader_2': 'DWI ARI PRASETYA',
        'Leader_3': 'ADI RIYANTO',
        'Leader_4': 'MOH FADHOLI'
    };
    return leaders[leaderCode] || leaderCode || '-';
}

function getComponentName(componentCode) {
    const components = {
        'Component_1': 'Engine',
        'Component_2': 'Clutch - Couper',
        'Component_3': 'PTO',
        'Component_4': 'Transmisi',
        'Component_5': 'Final Drive'
    };
    return components[componentCode] || componentCode || '-';
}
</script>

<script>
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('id-ID');
        document.getElementById('current-time').textContent = timeString;
    }
    
    updateTime();
    setInterval(updateTime, 1000);
</script>
{% endblock %}

{% block extra_js %}
<script>
// Function to show report detail popup
function showReportDetail(id, date, startTime, endTime, unitCode, component, activities, leader, hmkm, activityCode) {
    // Populate modal with data
    document.getElementById('modalDate').textContent = date;
    document.getElementById('modalTime').textContent = startTime + ' - ' + endTime;
    document.getElementById('modalUnitCode').textContent = unitCode || '-';
    document.getElementById('modalHmkm').textContent = hmkm || '-';
    document.getElementById('modalLeader').textContent = getLeaderName(leader);
    document.getElementById('modalComponent').textContent = getComponentName(component);
    document.getElementById('modalActivityCode').textContent = activityCode || '-';
    document.getElementById('modalActivities').textContent = activities || 'Tidak ada deskripsi aktivitas';
    
    // Show modal
    document.getElementById('reportDetailModal').classList.remove('hidden');
    document.body.style.overflow = 'hidden'; // Prevent background scrolling
}

// Function to close report detail popup
function closeReportDetail() {
    document.getElementById('reportDetailModal').classList.add('hidden');
    document.body.style.overflow = 'auto'; // Restore scrolling
}

// Helper function to get leader display name
function getLeaderName(leaderCode) {
    const leaders = {
        'Leader_1': 'YUDI SULISTIYONO',
        'Leader_2': 'DWI ARI PRASETYA',
        'Leader_3': 'ADI RIYANTO',
        'Leader_4': 'MOH FADHOLI'
    };
    return leaders[leaderCode] || leaderCode || '-';
}

// Helper function to get component display name
function getComponentName(componentCode) {
    const components = {
        'Component_1': 'Engine',
        'Component_2': 'Clutch - Couper',
        'Component_3': 'PTO',
        'Component_4': 'Transmisi',
        'Component_5': 'Final Drive',
        'Component_6': 'Travel - Axle',
        'Component_7': 'Steering',
        'Component_8': 'Under Carriage',
        'Component_9': 'Wheel',
        'Component_10': 'Frame & Guard',
        'Component_11': 'Electric',
        'Component_12': 'Brake',
        'Component_13': 'Suspension',
        'Component_14': 'Hydraulic',
        'Component_15': 'Pneumatic',
        'Component_16': 'Swing System',
        'Component_17': 'Attachment',
        'Component_18': 'GET',
        'Component_19': 'Vessel Assy',
        'Component_20': 'Generating Set',
        'Component_21': 'Dewatering Pump',
        'Component_22': 'Optional Accessories',
        'Component_23': 'Tank & Piping',
        'Component_24': 'AC',
        'Component_25': 'Stone Crusher',
        'Component_26': 'Daily Maintenance'
        // Add more components as needed
    };
    return components[componentCode] || componentCode || '-';
}

// Close modal when clicking outside
document.getElementById('reportDetailModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeReportDetail();
    }
});

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeReportDetail();
    }
});

// Initialize Lucide icons after DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
});
</script>

<script>
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('id-ID');
        document.getElementById('current-time').textContent = timeString;
    }
    
    updateTime();
    setInterval(updateTime, 1000);
</script>
{% endblock %}
